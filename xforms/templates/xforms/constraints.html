{% extends "xforms/layout_table.html" %}

<script>
{% block table_scripts %}

  function viewRow(row) {
    var itemId = row.attr("id");
    row.load("/xforms/{{xform.pk}}/field/{{field.pk}}/constraint/" + itemId + "/");
  }

  function editRow(link) {
    var itemId = $(link).parents(".row").attr("id");
    var url = "/xforms/{{xform.pk}}/field/{{field.pk}}/constraint/" + itemId + "/edit";
    var row = $(link).parents(".row");
    row.load(url);
    
  }
  
  function addConstraint() {
    $.get("/xforms/{{ xform.pk }}/field/{{field.pk}}/constraints/add", function(data) {
      $("#sortable").append("<li class='row'>" + data + "</li>");
    });
  }
  
  function add(link) {
    
    var row = $(link).parents(".row");
    var form = $("form");
    
    var form_data = form.serializeArray();
    
    $.post(form.attr("action"), form_data, function(data) {
      row.empty();
      row.append(data);
    });

  }
  
  function cancelSave(link) {
    viewRow($(link).parents(".row"))    
  }
  
  function saveRow(link) {
    form = $(link).parents(".form");
    form_data = form.serializeArray();
    
    var row = $(link).parents(".row");
    row.load(form.attr("action"), form_data);
  }
  
  function deleteRow(link) {
    var itemId = $(link).parents(".row").attr("id");
    if (confirm("Are you sure you want to delete this constraint?")) {
      $.post('/xforms/{{xform.pk}}/field/{{field.pk}}/constraint/' + itemId + '/delete/' , function(data) {
        $(link).parents(".row").remove();
      }); 
    }
  }
  
  
  
{% endblock %}
</script>



{% block table_header %}

Hello table header

{% endblock %}


{% block table_footer %}

<br/>
  <div class="buttons">
      <a href="javascript:addConstraint();" style="float:left">
        <img border="0" src="{{ MEDIA_URL }}rapidsms/icons/silk/add.png" alt=""/>Add Constraint
      </a>
  </div>

{% endblock %}
